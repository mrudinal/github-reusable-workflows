# Calls the reusable workflow in the "github-reusable-workflows" repo to:
# - Create/ensure a proxied CNAME: CUSTOM_DOMAIN -> PAGES_DEV_HOSTNAME
# - Attach CUSTOM_DOMAIN to an existing Cloudflare Pages project
# - Create a Bulk Redirect so https://<project>.pages.dev/* redirects to https://CUSTOM_DOMAIN
#
# Required GitHub Secrets in *this* repository:
# - CLOUDFLARE_API_TOKEN
# - CLOUDFLARE_ACCOUNT_ID
# - CLOUDFLARE_ZONE_ID
#
# Required GitHub Variables in *this* repository:
# - PAGES_PROJECT_NAME
# - PAGES_DEV_HOSTNAME
# - CUSTOM_DOMAIN
#
# Optional GitHub Variables in *this* repository:
# - BULK_REDIRECT_LIST_NAME
# - BULK_REDIRECT_RULE_REF
# - BULK_REDIRECT_RULESET_NAME
# - REDIRECT_STATUS_CODE (301, 302, 307, 308; default 301)
#
# Note: Update the `uses:` line to point at your workflow repo + ref.

name: "Cloudflare Pages: attach custom domain + redirect pages.dev (caller)"

on:
  workflow_dispatch:

jobs:
  call-reusable:
    name: "Configure Cloudflare Pages domain + redirects"
    uses: Max/github-reusable-workflows/.github/workflows/cloudflare-pages-subdomain-setup.yml@main
    secrets:
      CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
      CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
      CLOUDFLARE_ZONE_ID: ${{ secrets.CLOUDFLARE_ZONE_ID }}
